import"./modulepreload-polyfill-B5Qt9EMX.js";import{r as d,j as a,F as y,v as M,R as O}from"./rjsf-Cnrryt9B.js";import{a as F,g as P}from"./react-B9D_A6Vq.js";import{r as V}from"./quill-CuqxBHFt.js";import{u as G,D as T,a as U,b as w}from"./dnd-_YvmVDed.js";var C={},R;function $(){if(R)return C;R=1;var e=F();return C.createRoot=e.createRoot,C.hydrateRoot=e.hydrateRoot,C}var q=$();const z=P(q);var H=V();const B=P(H),X="1.0",J="SILIC 2.0",Q="Gerador de Edital CAIXA (Licitação)",K={layout:"3-colunas",colunas:{A:"Modelo Renderizado (preview)",B:"Texto-base editável com variáveis",C:"Dados estruturados da demanda (arrastar/soltar)"}},W=["inserir_valor","inserir_variavel"],Z=["DRAFT","DONE"],Y=[{id:"identificacao",titulo:"Identificação do certame",campos:[{id:"licitacao_numero",label:"Número da licitação",tipo:"string",origem:"silic",silic_path:"demanda.licitacao.numero",obrigatorio:!0,tokens_docx:["Licitação"],validacoes:["regex:^\\d{1,4}/\\d{4}$"]},{id:"licitacao_ano",label:"Ano",tipo:"int",origem:"derivado",derivacao:"extrair_ano(licitacao_numero)",obrigatorio:!0,tokens_docx:["Ano"]},{id:"unidade_demandante",label:"Unidade demandante da licitação",tipo:"string",origem:"silic",silic_path:"demanda.unidade.nome",obrigatorio:!0,tokens_docx:["Unidade_Demandante_da_Licitação"]},{id:"sigla_unidade",label:"Sigla da unidade",tipo:"string",origem:"silic",silic_path:"demanda.unidade.sigla",obrigatorio:!1,tokens_docx:["SIGLA"]},{id:"uf_demanda",label:"UF da demanda",tipo:"uf",origem:"silic",silic_path:"demanda.unidade.uf",obrigatorio:!1,tokens_docx:["UF_da_Demanda"]},{id:"licitador",label:"Licitador responsável",tipo:"string",origem:"silic",silic_path:"demanda.licitador.nome",obrigatorio:!0,tokens_docx:["Licitador"]}]},{id:"publicacao_marcos",titulo:"Publicação e marcos (datas/horas)",campos:[{id:"data_dou",label:"Data da publicação no DOU",tipo:"date",origem:"silic",silic_path:"demanda.publicacao.dou.data",obrigatorio:!0,tokens_docx:["Data_DOU","Ano_DOU","Mês_DOU_Extenso"]},{id:"dt_cred_propostas",label:"Data do credenciamento e recebimento de propostas",tipo:"date",origem:"silic",silic_path:"demanda.sessao.credenciamento.data",obrigatorio:!0,tokens_docx:["Dt_Cred_e_Propostas"]},{id:"hora_cred",label:"Hora limite do credenciamento",tipo:"time",origem:"silic",silic_path:"demanda.sessao.credenciamento.hora",obrigatorio:!0,tokens_docx:["Hora_Cred"]},{id:"hora_prop",label:"Hora limite de envio de propostas",tipo:"time",origem:"silic",silic_path:"demanda.sessao.propostas.hora",obrigatorio:!0,tokens_docx:["Hora_Prop"]},{id:"dt_sessao_lances",label:"Data da sessão pública de lances",tipo:"date",origem:"silic",silic_path:"demanda.sessao.lances.data",obrigatorio:!0,tokens_docx:["Dt_Sessão_de_Lances"]},{id:"hora_lances",label:"Hora de abertura de lances",tipo:"time",origem:"silic",silic_path:"demanda.sessao.lances.hora",obrigatorio:!0,tokens_docx:["Hora_Lances"]},{id:"dt_impug_esclar",label:"Data limite para impugnações e esclarecimentos",tipo:"date",origem:"derivado",derivacao:"calcular_limite_impugnacao(dt_sessao_lances, regra='2_dias_uteis_antes')",obrigatorio:!0,tokens_docx:["Dt_ImpugEsclar"]},{id:"hora_esclarecimentos",label:"Hora limite para esclarecimentos",tipo:"time",origem:"manual",obrigatorio:!1,tokens_docx:["Hora_Esclarecimentos"]}],validacoes_grupo:["dt_cred_propostas <= dt_sessao_lances","hora_prop <= hora_lances quando dt_cred_propostas == dt_sessao_lances"]},{id:"objeto",titulo:"Objeto e escopo",campos:[{id:"objeto",label:"Objeto (texto completo)",tipo:"text",origem:"silic|manual",silic_path:"demanda.objeto.texto",obrigatorio:!0,tokens_docx:["Objeto"]},{id:"objeto_resumido",label:"Objeto resumido",tipo:"string",origem:"silic|manual",silic_path:"demanda.objeto.resumo",obrigatorio:!0,tokens_docx:["Objeto_Resumido","OBJETO_RESUMIDO"]},{id:"endereco_execucao",label:"Endereço/local de execução",tipo:"text",origem:"silic|manual",silic_path:"demanda.local_execucao.endereco",obrigatorio:!1,tokens_docx:["Endereço"]}]},{id:"valores",titulo:"Valores, estimativas e garantias",campos:[{id:"valor_mensal_contratado",label:"Valor mensal contratado",tipo:"money",origem:"silic|manual",silic_path:"demanda.valores.mensal",obrigatorio:!1,tokens_docx:["Valor_Mensal_Contratado","Extenso_Valor_Mensal_Contratado"]},{id:"valor_global_contratado",label:"Valor global contratado",tipo:"money",origem:"silic|manual",silic_path:"demanda.valores.global",obrigatorio:!1,tokens_docx:["Valor_Global_Contratado","Extenso_Valor_Global_Contratado"]},{id:"estimativa_sigilosa",label:"Estimativa orçamentária sigilosa?",tipo:"boolean",origem:"manual",obrigatorio:!0,regras:[{quando:"estimativa_sigilosa == false",acao:"remover_blocos",alvos:["edital.item_6_4_2","edital.item_6_4_2_1"]},{quando:"estimativa_sigilosa == true",acao:"incluir_blocos",alvos:["edital.item_6_4_2","edital.item_6_4_2_1"]}]},{id:"garantia_percentual",label:"Percentual de garantia",tipo:"percent",origem:"manual",obrigatorio:!1,tokens_docx:["M__Garantia"]},{id:"valor_garantia",label:"Valor de garantia (R$)",tipo:"money",origem:"derivado",derivacao:"calcular_garantia(valor_global_contratado, garantia_percentual)",obrigatorio:!1,tokens_docx:["Valor_Garantia_R","Garantia_Extenso","Garantia_Extenso1"]},{id:"recurso_orcamentario",label:"Recurso orçamentário",tipo:"string",origem:"silic|manual",silic_path:"demanda.orcamento.recurso",obrigatorio:!1,tokens_docx:["Rec_Orçamentário"]}]},{id:"partes_contrato",titulo:"Partes e minuta contratual",campos:[{id:"numero_contrato",label:"Número do contrato",tipo:"string",origem:"silic|manual",silic_path:"contrato.numero",obrigatorio:!1,tokens_docx:["Nº_Contrato"]},{id:"processo",label:"Processo administrativo",tipo:"string",origem:"silic",silic_path:"demanda.processo.numero",obrigatorio:!0,tokens_docx:["Processo"]},{id:"doc_autorizacao",label:"Documento de autorização",tipo:"string",origem:"silic|manual",silic_path:"demanda.autorizacao.numero",obrigatorio:!0,tokens_docx:["Doc_Autorização","Data_Doc_Autorização","Autorizador_Contratação"]},{id:"nome_repr_caixa",label:"Representante CAIXA - Nome",tipo:"string",origem:"silic",silic_path:"contrato.representante_caixa.nome",obrigatorio:!1,tokens_docx:["Nome_Repr_CAIXA"]},{id:"cpf_repr_caixa",label:"Representante CAIXA - CPF",tipo:"cpf",origem:"silic",silic_path:"contrato.representante_caixa.cpf",obrigatorio:!1,tokens_docx:["CPF_Repr_CAIXA"]},{id:"cargo_repr_caixa",label:"Representante CAIXA - Cargo",tipo:"string",origem:"silic",silic_path:"contrato.representante_caixa.cargo",obrigatorio:!1,tokens_docx:["Cargo_Repr_CAIXA"]},{id:"empresa_nome",label:"Empresa contratada/licitante",tipo:"string",origem:"silic",silic_path:"fornecedor.nome",obrigatorio:!0,tokens_docx:["Empresa"]},{id:"empresa_cnpj",label:"CNPJ",tipo:"cnpj",origem:"silic",silic_path:"fornecedor.cnpj",obrigatorio:!0,tokens_docx:["CNPJ_Empresa"]},{id:"empresa_endereco_completo",label:"Endereço completo da empresa",tipo:"text",origem:"silic|manual",silic_path:"fornecedor.endereco.completo",obrigatorio:!1,tokens_docx:["Endereço_Completo_Empresa"]}]},{id:"vigencia_assinaturas",titulo:"Vigência e assinaturas",campos:[{id:"vigencia_texto",label:"Vigência (texto)",tipo:"string",origem:"manual",obrigatorio:!1,tokens_docx:["Vigência","Extenso_Vig"]},{id:"inicio_vigencia",label:"Início da vigência",tipo:"date",origem:"manual",obrigatorio:!1,tokens_docx:["Início_Vigência"]},{id:"data_subs",label:"Data de assinatura/subscrição",tipo:"date",origem:"manual",obrigatorio:!1,tokens_docx:["Data_Subs","Ano_Assin","Mês_Assin"]},{id:"livro_subs",label:"Livro (subscrição)",tipo:"string",origem:"manual",obrigatorio:!1,tokens_docx:["Livro_Subs"]},{id:"pagina_subs",label:"Página (subscrição)",tipo:"string",origem:"manual",obrigatorio:!1,tokens_docx:["Pág__Subs"]},{id:"designacao",label:"Designação/ato",tipo:"string",origem:"manual",obrigatorio:!1,tokens_docx:["Designação"]},{id:"lotacao",label:"Lotação",tipo:"string",origem:"manual",obrigatorio:!1,tokens_docx:["Lotação"]}]}],ee=["Ano","Ano_Assin","Ano_DOU","Autorizador_Contratação","CNPJ_Empresa","CPF_Repr_CAIXA","CPF_Repres_1","CPF_Repres_2","Cargo","Cargo_Repr_CAIXA","Data_DOU","Data_Doc_Autorização","Data_Subs","Designação","Doc_Autorização","Dt_Cred_e_Propostas","Dt_ImpugEsclar","Dt_Sessão_de_Lances","Empresa","Endereço","Endereço_Completo_Empresa","Extenso_Valor_Global_Contratado","Extenso_Valor_Mensal_Contratado","Extenso_Vig","Garantia_Extenso","Garantia_Extenso1","Hora_Cred","Hora_Esclarecimentos","Hora_Lances","Hora_Prop","Início_Vigência","Licitador","Licitação","Livro_Subs","Lotação","M__Garantia","Mês_Assin","Mês_DOU_Extenso","Nome_Repr_CAIXA","Nome_Repres_1","Nome_Repres_2","Nº_Contrato","OBJETO_RESUMIDO","Objeto","Objeto_Resumido","Patrimônio_Líq","Patrimônio_Líquido_Extenso","Processo","Pág__Subs","Rec_Orçamentário","SIGLA","UF_da_Demanda","Unidade_Demandante_da_Licitação","Valor_Garantia_R","Valor_Global_Contratado","Valor_Mensal_Contratado","Vigência"],ae={schema_version:X,produto:J,artefato:Q,ui:K,modos_insercao_drag_drop:W,status_documento:Z,grupos:Y,tokens_docx_detectados:ee},S=[{value:"AC",label:"Acre"},{value:"AL",label:"Alagoas"},{value:"AP",label:"Amapá"},{value:"AM",label:"Amazonas"},{value:"BA",label:"Bahia"},{value:"CE",label:"Ceará"},{value:"DF",label:"Distrito Federal"},{value:"ES",label:"Espírito Santo"},{value:"GO",label:"Goiás"},{value:"MA",label:"Maranhão"},{value:"MT",label:"Mato Grosso"},{value:"MS",label:"Mato Grosso do Sul"},{value:"MG",label:"Minas Gerais"},{value:"PA",label:"Pará"},{value:"PB",label:"Paraíba"},{value:"PR",label:"Paraná"},{value:"PE",label:"Pernambuco"},{value:"PI",label:"Piauí"},{value:"RJ",label:"Rio de Janeiro"},{value:"RN",label:"Rio Grande do Norte"},{value:"RS",label:"Rio Grande do Sul"},{value:"RO",label:"Rondônia"},{value:"RR",label:"Roraima"},{value:"SC",label:"Santa Catarina"},{value:"SP",label:"São Paulo"},{value:"SE",label:"Sergipe"},{value:"TO",label:"Tocantins"}],oe="^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$",ie="^\\d{2}\\.\\d{3}\\.\\d{3}/\\d{4}-\\d{2}$",te=["inserir_variavel","inserir_valor"];function I(e){return e?.toLowerCase()??"string"}function re(e){if(e){for(const o of e)if(o.startsWith("regex:"))return o.replace(/^regex:/,"")}}function se(e){if(e==="text")return{"ui:widget":"textarea","ui:options":{rows:5}};if(e==="money"||e==="percent")return{"ui:widget":"updown","ui:options":{step:.01,inputType:"number"}};if(e==="int")return{"ui:widget":"updown","ui:options":{step:1,inputType:"number"}}}function ne(e){const o=I(e.tipo),t=e.label??e.id;switch(o){case"int":return 1;case"money":return 1500.5;case"percent":return 10;case"boolean":return!1;case"date":return"2025-01-10";case"time":return"10:00";case"uf":return"DF";case"cpf":return"123.456.789-00";case"cnpj":return"12.345.678/0001-90";case"text":return`Texto para ${t}`;default:return`${t} (mock)`}}function le(e,o){const t=I(e.tipo),i={type:["text","string","uf","cpf","cnpj"].includes(t)?"string":t==="int"?"integer":t==="boolean"?"boolean":t==="money"||t==="percent"?"number":"string",title:e.label||e.id};o!=null&&(i.default=o),t==="date"&&(i.format="date"),t==="time"&&(i.format="time"),t==="money"&&(i.minimum=0,i.multipleOf=.01),t==="percent"&&(i.minimum=0,i.maximum=100,i.multipleOf=.01),t==="uf"&&(i.enum=S.map(c=>c.value),i.enumNames=S.map(c=>c.label)),t==="cpf"&&(i.pattern=oe),t==="cnpj"&&(i.pattern=ie);const s=re(e.validacoes);s&&(i.pattern=s);const l=se(t);return{schema:i,uiSchema:l}}function ce(e){const o=[],t={},i=[];e.grupos.forEach(l=>{const c={},m=[],_={},h=[];l.campos.forEach(n=>{const p=ne(n);t[n.id]=p;const{schema:D,uiSchema:f}=le(n,p);c[n.id]=D,n.obrigatorio&&m.push(n.id),f&&(_[n.id]=f),h.push(n.id),(n.origem?n.origem.toLowerCase().split("|").includes("silic"):!1)&&i.push({id:n.id,label:n.label,origin:n.origem,tokens:n.tokens_docx,silicPath:n.silic_path,mockValue:p,tipo:n.tipo})});const x={type:"object",properties:c};m.length>0&&(x.required=m),o.push({id:l.id,title:l.titulo,schema:x,uiSchema:_,fieldIds:h})});const s=e.modos_insercao_drag_drop?.length?e.modos_insercao_drag_drop:te;return{sections:o,initialData:t,silicFields:i,dragModes:s,raw:e}}const de=ae,b=ce(de),k="form-renderer-editor",ue=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:2});function L(e,o){if(o==null||o==="")return"—";const t=e.tipo.toLowerCase();if(t==="money"){const i=typeof o=="number"?o:Number(o);return ue.format(Number.isNaN(i)?0:i)}if(t==="percent"){const i=typeof o=="number"?o:Number(o);return`${Number.isNaN(i)?0:i}%`}if(typeof o=="boolean")return o?"Sim":"Não";if(t==="date"&&typeof o=="string"&&o.includes("-")){const[i,s,l]=o.split("-");return`${l}/${s}/${i}`}return String(o)}function me({field:e,value:o,onInsert:t}){const{attributes:i,listeners:s,setNodeRef:l,transform:c,isDragging:m}=w({id:e.id,data:{field:e}}),_=c?{transform:`translate3d(${c.x}px, ${c.y}px, 0)`}:void 0;return a.jsxs("button",{type:"button",className:`silic-chip ${m?"dragging":""}`,ref:l,style:_,onClick:()=>t?.(e),...s,...i,children:[a.jsx("div",{className:"silic-chip-label",children:e.label}),a.jsx("div",{className:"silic-chip-value",children:L(e,o)}),a.jsxs("div",{className:"silic-chip-meta",children:[a.jsx("span",{className:"origin",children:e.origin.toUpperCase()}),e.tokens?.[0]&&a.jsxs("span",{className:"token",children:["[",e.tokens[0],"]"]})]})]})}function _e({field:e,value:o}){return a.jsxs("div",{className:"silic-chip overlay",children:[a.jsx("div",{className:"silic-chip-label",children:e.label}),a.jsx("div",{className:"silic-chip-value",children:L(e,o)})]})}function pe({section:e,formData:o,onChange:t}){const i=d.useMemo(()=>e.fieldIds.reduce((s,l)=>(s[l]=o[l],s),{}),[o,e.fieldIds]);return a.jsxs("details",{className:"section-card",open:!0,children:[a.jsx("summary",{children:e.title}),a.jsx(y,{schema:e.schema,uiSchema:e.uiSchema,formData:i,validator:M,showErrorList:!1,liveValidate:!0,onChange:s=>t(s.formData??{}),children:a.jsx("div",{className:"hidden-submit"})})]})}function ge(){const[e,o]=d.useState(()=>({...b.initialData})),[t,i]=d.useState("<p>Monte o texto base do edital aqui…</p>"),[s,l]=d.useState(null),[c,m]=d.useState(b.dragModes[0]??"inserir_variavel"),_=d.useRef(null),{setNodeRef:h,isOver:x}=G({id:k}),n=d.useCallback(r=>{o(u=>({...u,...r}))},[]),p=d.useCallback(r=>{const u=e[r.id],j=c==="inserir_valor"?String(u??r.mockValue??""):`[${r.tokens?.[0]??r.id}]`,g=_.current?.getEditor();if(g){const v=g.getSelection(!0),E=v?v.index:g.getLength()-1;g.insertText(E,j),g.setSelection(E+j.length,0),i(g.root.innerHTML)}else i(v=>`${v}${j}`)},[c,e]),D=d.useCallback(r=>{const u=r.active.data.current?.field;l(u??null)},[]),f=d.useCallback(r=>{const u=r.active.data.current?.field;u&&r.over?.id===k&&p(u),l(null)},[p]),A=d.useCallback(()=>{l(null)},[]);return a.jsxs(T,{onDragStart:D,onDragEnd:f,onDragCancel:A,children:[a.jsxs("div",{className:"form-renderer",children:[a.jsxs("header",{className:"renderer-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Form Renderer – Gerador de Edital CAIXA"}),a.jsx("p",{children:"Selecione os campos do SILIC, edite o formulário nas seções e arraste/solte chips para preencher o texto-base do edital."})]}),a.jsxs("div",{className:"drag-mode-toggle",children:[a.jsx("span",{children:"Modo de inserção:"}),b.dragModes.map(r=>a.jsxs("label",{children:[a.jsx("input",{type:"radio",value:r,checked:c===r,onChange:()=>m(r)}),r==="inserir_valor"?"Valor mockado":"Variável [TOKEN]"]},r))]})]}),a.jsxs("div",{className:"renderer-columns",children:[a.jsxs("section",{className:"column column-preview",children:[a.jsx("h2",{children:"Coluna A · Formulário"}),a.jsx("div",{className:"accordion-list",children:b.sections.map(r=>a.jsx(pe,{section:r,formData:e,onChange:n},r.id))})]}),a.jsxs("section",{className:`column column-editor ${x?"dropping":""}`,ref:h,children:[a.jsx("h2",{children:"Coluna B · Texto-base (TipTap/Quill)"}),a.jsx("p",{className:"editor-hint",children:"Arraste um chip e solte dentro do editor para inserir."}),a.jsx(B,{ref:_,theme:"snow",value:t,onChange:i,placeholder:"Clique e comece a editar..."})]}),a.jsxs("section",{className:"column column-chips",children:[a.jsx("h2",{children:"Coluna C · Dados SILIC"}),a.jsx("p",{children:"Arraste um campo para o editor ou clique para copiar o valor."}),a.jsx("div",{className:"chips-list",children:b.silicFields.map(r=>a.jsx(me,{field:r,value:e[r.id],onInsert:p},r.id))})]})]})]}),a.jsx(U,{children:s?a.jsx(_e,{field:s,value:e[s.id]}):null})]})}const N=document.getElementById("form-renderer-root");N&&z.createRoot(N).render(a.jsx(O.StrictMode,{children:a.jsx(ge,{})}));
